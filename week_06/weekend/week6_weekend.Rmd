---
title: "Week 6 weekend homework"
output: html_notebook
---

```{r}
#load libraries
library(tidyverse)
library(infer)
```

Part 1 - Hypothesis testing practical

Question 1
```{r}
#load data
data("msleep")

head(msleep)
```

Question 2

H0: µ(animals sleep) = 7
Ha: µ(animals sleep) ≠ 7

alpha = 0.05

```{r}
# Get observed stats for sample population:
observed_stat <- msleep %>% 
  summarise(sample_mean = mean(sleep_total))

observed_stat
```

```{r}
# Generate null distribution
null_distribution <- msleep %>% 
  specify(response = sleep_total) %>% 
  hypothesise(null = "point",
              mu = 7) %>% 
  generate(reps = 10000,
           type = "bootstrap") %>% 
  calculate(stat = "mean")
```

```{r}
null_distribution %>% 
  visualise(bins = 30) +
  shade_p_value(obs_stat = observed_stat$sample_mean,
                direction = "both"
  )
```

```{r}
p_value <- null_distribution %>% 
  get_pvalue(obs_stat = observed_stat$sample_mean,
              direction = "both")            

p_value
```

The p-value of 0 is less than alpha = 0.5 and the null hypothesis H0 is rejected


Question 3

H0: µ(omnivores sleep) - µ(herbivores) = 0
Ha: µ(omnivores sleep) - µ(herbivores) > 0

Alpha = 0.05

```{r}
msleep_omni_herbi <- msleep %>% 
  filter(vore %in% c("omni", "herbi"))

# Get observed stat
observed_stat <- msleep_omni_herbi %>% 
  specify(response = sleep_total,
          explanatory = vore) %>% 
  calculate(stat = "diff in means",
            order = c("omni", "herbi"))

observed_stat
```


```{r}
# Generate null distribution
null_distribution <- msleep_omni_herbi %>% 
  specify(response = sleep_total,
          explanatory = vore) %>% 
  hypothesise(null = "independence") %>% 
  generate(reps = 10000,
           type = "permute") %>% 
  calculate(stat = "diff in means",
            order = c("omni", "herbi"))
```

```{r}
# Visualise null distribution
null_distribution %>% 
  visualise() +
  shade_p_value(obs_stat = observed_stat,
                direction = "right")
```

```{r}
p_value <- null_distribution %>% 
  get_pvalue(obs_stat = observed_stat,
              direction = "right")

p_value
```

With the p-value of 0.12 being greater than alpha = 0.05 we fail to reject H0.

Question 3

H0: ∏ domesticated animals in population = 5%
Ha: ∏ Proportion of domesticated animals in population > 5%

Alpha = 0.05

```{r}
# Add is_domesticated variable
msleep_dom <- msleep %>% 
  mutate(is_domesticated = if_else(conservation == "domesticated", "yes", "no"))
```

```{r}
# Generate null distribution
null_distribution <- msleep_dom %>% 
  specify(response = is_domesticated,
          success = "yes") %>% 
  hypothesise(null = "point",
              p = 0.05) %>% 
  generate(reps = 10000,
           type = "simulate") %>% 
  calculate(stat = "prop")
```

```{r}
# Calculate observed stat:
observed_stat <- msleep_dom %>% 
  specify(response = is_domesticated, 
          success = "yes") %>% 
  calculate(stat = "prop")

observed_stat
```

```{r}
null_distribution %>% 
  visualise(bins = 30) +
  shade_p_value(obs_stat = observed_stat$stat,
                direction = "right")
```

```{r}
null_distribution %>% 
  get_p_value(obs_stat = observed_stat$stat,
                direction = "right")
```

The p-value is less than alpha = 0.05 so we can reject the null hypothesis H0.


Part 2: Defining the Hypothesis

Question 1:

This requires a one-sample test.

The null hypothesis is that the proportion of the town which has heard of the coffee shop is 40%. 
The alternative hypothesis is that the proportion of the town that has heard of the coffee shop is more than 40%.

H0: π(heard of coffee shop) = 0.4
H1: π(heard of coffee shop) > 0.4

The null distribution would be generated by simulation.


Question 2:

This requires a two-sample test of independent observations.

The null hypothesis is that the proportion of users clicking the banner in group B is the same as that of group A.
The alternative hypothesis is that the proportion clicking the banner in group B is higher than that in group A.

H0: π(users clicking banner in group B) - π(users clicking banner in group A) = 0
Ha: π(users clicking banner in group B) - π(users clicking banner in group A) > 0

The null distribution would be generated by permutation.


Question 3: 

This requires a one-sample test.

The null hypothesis is that the mean width of the sampled parts is 145mm.
The alternative hypothesis is that the mean width of the sampled parts is not 145mm.

H0: µ(width) = 145
H1: µ(width) ≠ 145

The null distribution would be generated by bootstrapping.


Part 3 - Interpreting the results

Question 1:

alpha = 0.05, p = 0.07
As p > alpha then we fail to reject the null hypothesis, i.e there is no evidence to disprove that the proportion of the town which has heard of the coffee shop is 40%.

Question 2:

alpha = 0.01, p = 0.006
As p < alpha then we can reject the null hypothesis, i.e. we can reject that the proportion of users clicking the banner in group B is the same as that of group A.

Question 3:

alpha = 0.05, p = 0.55
As p > alpha then we fail to reject the null hypothesis, i.e. there is no evidence to disprove that the mean width of the sampled parts is 145mm.



EXTENSION

```{r}
transactions <- read_csv("data/online_retail_subset.csv") %>% 
  janitor::clean_names()
```

```{r}
# Support for Item A = num of transactions involving A / total num of transactions
# Need to find the number of unique transactions and also the number of transactions involving A

unique_trans <- transactions %>%
  distinct(invoice_no)

# Get individual supports for each stock_code
stock_transactions <- transactions %>% 
  group_by(stock_code) %>% 
  summarise(num_stock_trans = n()) %>% 
  mutate(support = num_stock_trans/nrow(unique_trans))
  
support_a <- stock_transactions %>% 
  filter(stock_code == 22469)

support_a
```
For rule (A -> B):
Support = (number of transactions involving A and B)/Total number of transactions

Confidence = P(A and B purchased together)/P(A being purchased) = P(A and B)/P(A)

```{r}
support_ab <- transactions %>% 
  filter(stock_code )
```

